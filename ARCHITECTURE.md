# Архитектура Проекта "ProDvor" (Feature-Sliced Design)

**Версия:** 2.0  
**Дата последнего обновления:** 29.07.2024

Этот документ является основным техническим руководством для разработчиков фронтенд-части платформы "ProDvor" и описывает внедренную архитектурную методологию **Feature-Sliced Design (FSD)**.

## 1. Обзор методологии FSD

Feature-Sliced Design — это архитектурная методология для фронтенд-приложений, которая структурирует код по бизнес-областям, а не по техническому назначению. Основная цель — сделать проект управляемым, масштабируемым и понятным для команды.

Ключевые принципы FSD:
- **Модульность:** Код сгруппирован по функциональным частям (слайсам).
- **Низкая связанность:** Модули минимально зависят друг от друга.
- **Высокая сплоченность:** Код внутри модуля максимально связан по смыслу.
- **Контролируемые зависимости:** Строгие правила импорта между слоями.

## 2. Структура слоев

Проект "ProDvor" строго следует иерархии слоев FSD. Каждый слой имеет свое назначение, и импорты разрешены только от верхних слоев к нижним (например, `widgets` может импортировать из `features`, но не наоборот).

- **7. `app` — Приложение**  
  Инициализация приложения: настройка роутинга, глобальные стили, провайдеры (темы, сессии).

- **6. `pages` — Страницы**  
  Композиция виджетов и фич для формирования конкретных страниц. Здесь не должно быть логики.

- **5. `widgets` — Виджеты**  
  Составные, независимые блоки интерфейса (например, `Header`, `UserProfile`, `TeamRoster`). Собираются из фич и сущностей.

- **4. `features` — Функциональность**  
  Пользовательские сценарии (user stories). Например, `send-message`, `add-to-friends`, `login-form`. Имеют бизнес-логику и взаимодействуют с API.

- **3. `entities` — Бизнес-сущности**  
  Бизнес-модели и компоненты для их отображения (например, `User`, `Team`, `Match`). Карточка пользователя (`UserCard`) — типичный пример.

- **2. `processes` — Процессы (Опционально)**  
  Сценарии, охватывающие несколько страниц (например, процесс онбординга или оплаты). В текущей реализации используется минимально.

- **1. `shared` — Переиспользуемый код**  
  Самый нижний слой. Содержит UI-кит (кнопки, инпуты), утилиты (`cn`), хелперы, типы и моковые данные. Не содержит бизнес-логики.

## 3. Правила импорта

**Золотое правило:** Модуль может импортировать только те модули, что находятся на слоях ниже него. Импорт "вбок" (между слайсами одного слоя) или "вверх" строго запрещен.

- ✅ **Правильно:** `widget/UserProfile` импортирует `feature/send-friend-request`.
- ❌ **Неправильно:** `feature/send-friend-request` импортирует `widget/UserProfile`.
- ❌ **Неправильно:** `feature/send-friend-request` импортирует `feature/block-user`.
- ✅ **Правильно:** Любой слой может импортировать из `shared`.

Для обеспечения этих правил используются абсолютные импорты с помощью `paths` в `tsconfig.json` (e.g., `@/entities/user`).

## 4. Code Splitting и Lazy Loading

Для оптимизации производительности мы активно используем динамические импорты для страниц и крупных виджетов с помощью `next/dynamic`.

**Пример (Next.js Page):**
```tsx
import dynamic from 'next/dynamic';
import { Skeleton } from '@/shared/ui/skeleton';

const DashboardPage = dynamic(
  () => import('@/pages/dashboard').then((mod) => mod.DashboardPage),
  {
    loading: () => <Skeleton className="h-screen w-full" />,
    ssr: false, // Отключаем SSR для страниц, не требующих SEO-индексации
  }
);

export default DashboardPage;
```
Этот подход применяется ко всем страницам в директории `src/app/(app)/`.

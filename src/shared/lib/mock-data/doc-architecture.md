# Техническая Документация Проекта "ProDvor"

**Версия:** 1.4 | **Дата последнего обновления:** 31.07.2024

Этот документ является основным техническим руководством для разработчиков фронтенд-части платформы "ProDvor". Он описывает архитектуру, технологический стек, стандарты кодирования и ключевые принятые решения.

## 1. Введение

### 1.1. Общее описание продукта

ProDvor — это социальная веб-платформа, предназначенная для объединения участников дворового и любительского спорта. Она предоставляет инструменты для создания профилей, команд, организации турниров и ведения спортивной жизни онлайн.

**Цели фронтенда:**

*   Предоставить пользователям интуитивно понятный, быстрый и адаптивный интерфейс.
*   Обеспечить высокую производительность и доступность на всех современных устройствах.
*   Создать масштабируемую и поддерживаемую кодовую базу, готовую к быстрому добавлению нового функционала.

### 1.2. Термины и сокращения

*   **FSD (Feature-Sliced Design)** — основная архитектурная методология проекта.
*   **RSC (React Server Components)** — серверные компоненты React, используемые по умолчанию.
*   **ADR (Architecture Decision Record)** — запись об архитектурном решении.
*   **NFR (Non-Functional Requirements)** — нефункциональные требования.
*   **API** — интерфейс взаимодействия с бэкендом.

## 2. Требования к фронтенду

### 2.1. Требования к платформе

*   **Фреймворк:** Next.js 15.3+ (App Router). Выбран за его гибридный рендеринг, производительность (RSC) и оптимизацию для SEO.
*   **Язык:** TypeScript. Выбран для обеспечения строгой типизации, улучшения читаемости кода и снижения ошибок на этапе разработки.
*   **Сборщик:** Turbopack (в режиме разработки).
*   **Стилизация:** Tailwind CSS. Выбран за утилитарный подход, позволяющий быстро создавать адаптивные интерфейсы без написания лишнего CSS.
*   **UI-компоненты:** ShadCN UI. Выбрана за композитность, доступность и отличную интеграцию с Tailwind и Next.js.
*   **AI-функциональность:** Genkit. Выбран как стандартизированный инструмент для работы с генеративными моделями.

### 2.2. Требования к браузерам и устройствам

*   **Десктопные браузеры:** Последние 2 версии Google Chrome, Mozilla Firefox, Apple Safari, Microsoft Edge.
*   **Мобильные браузеры:** Safari на iOS, Google Chrome на Android.
*   **Устройства:** Приложение должно корректно отображаться и функционировать на смартфонах, планшетах и десктопах.

### 2.3. Адаптивность

Проект разрабатывается по принципу **mobile-first**. Все компоненты и страницы изначально стилизуются для мобильных экранов, а затем адаптируются для более крупных разрешений с помощью брейкпоинтов Tailwind CSS.

### 2.4. Безопасность

*   **Протокол:** Приложение должно работать исключительно по HTTPS.
*   **Хранение токенов:** Сессия пользователя хранится в `httpOnly` cookie. Это предотвращает доступ к сессии через JavaScript на клиенте и защищает от XSS-атак.
*   **Защита маршрутов:** Middleware (`src/middleware.ts`) проверяет наличие cookie сессии и защищает все непубличные маршруты.
*   **CSRF:** Next.js имеет встроенные механизмы защиты от CSRF.
*   **Планы на продакшен:** Переход на JWT-токены и связку Kong + Keycloak, как описано в [документации бэкенда](/documents/backend-documentation).

### 2.5. Нефункциональные требования (NFRs)

*   **Производительность:**
    *   **LCP (Largest Contentful Paint):** не более 2.5 секунд для ключевых страниц.
    *   **FID (First Input Delay):** не более 100 мс.
    *   **Размер бандла JavaScript** для первоначальной загрузки страницы не должен превышать 200 KB (до сжатия).
*   **Доступность (Accessibility, a11y):**
    *   Все интерактивные элементы должны быть доступны с клавиатуры.
    *   Использование семантического HTML и ARIA-атрибутов для улучшения работы скрин-ридеров.
*   **Надежность:**
    *   Использование `error.js` в Next.js для обработки ошибок на уровне маршрутов.
    *   Централизованная обработка ошибок в Server Actions и Genkit-флоу.

## 3. Информационная архитектура

### 3.1. Карта страниц (Sitemap)

Ниже представлена структура основных маршрутов и страниц приложения.

*   **/ (Landing)**: Основная целевая страница для новых пользователей.
*   **/auth**: Страница входа и регистрации.
*   **/dashboard**: Главная страница после входа, лента новостей.
*   **/profile**: Перенаправление на профиль текущего пользователя.
*   **/profiles/[role]/[id]**: Просмотр профилей пользователей.
*   **/teams**: Список команд.
*   **/teams/new**: Мастер создания новой команды.
*   **/teams/[slug]**: Публичная страница команды.
*   **/teams/[slug]/management**: Управление командой для капитана.
*   **/tournaments**: Список турниров.
*   **/tournaments/new**: Мастер создания нового турнира.
*   **/tournaments/[slug]**: Публичная страница турнира.
*   **/playgrounds**: Карта и список спортивных площадок.
*   **/playgrounds/new**: Добавление новой площадки.
*   **/playgrounds/[id]**: Страница площадки.
*   **/training**: Хаб тренировок.
*   **/training/programs**: Список программ тренировок.
*   **/training/programs/new**: Конструктор программ тренировок.
*   **/training/exercises**: Каталог упражнений.
*   **/training/log**: Дневник тренировок.
*   **/settings**: Настройки профиля пользователя.
*   **/administration**: Панель администратора (содержит множество вложенных страниц для управления).

### 3.2. Модели данных

Мы придерживаемся принципа **"Единого Источника Правды" (Single Source of Truth)**. Сами файлы с типами TypeScript в `src/entities/**/model/types.ts` являются наиболее точной и актуальной документацией наших моделей данных.

**Ключевые сущности:**

*   **User:** Представляет зарегистрированного пользователя. Содержит основную информацию, роль, статистику и т.д.
*   **Team:** Описывает спортивную команду. Включает название, логотип, состав, капитана, статистику.
*   **Match:** Детальная информация о матче.
*   **Tournament:** Описывает турнир, включая сетку, участников и правила.
*   **Playground:** Спортивная площадка с адресом, типом, удобствами и отзывами.
*   **TrainingProgram:** План тренировок с набором упражнений, разбитых по дням.

*Источник правды: Файлы `types.ts` внутри каждого слайса в `src/entities/`.*

## 4. UI/UX-документация

### 4.1. Дизайн-система

*   **Библиотека компонентов:** ShadCN UI. Компоненты находятся в `src/shared/ui/`.
*   **Цветовая палитра:** Определена как CSS-переменные HSL в `src/app/globals.css`.
*   **Типографика:** Шрифты Inter (основной) и Space Grotesk (заголовки). Конфигурация в `tailwind.config.ts`.
*   **Иконки:** Lucide React.
*   **Классы:** Для управления классами используются утилиты `clsx` и `tailwind-merge` для избежания конфликтов.

## 5. FSD-структура проекта

### 5.1. Описание слоев

*   **app:** Инициализация приложения, глобальные стили, корневые провайдеры и макеты.
*   **views:** Компоненты страниц, которые собирают виджеты и фичи для конкретного маршрута.
*   **widgets:** Составные, самостоятельные блоки UI, имеющие ценность для бизнеса (например, `Sidebar`, `TeamChat`).
*   **features:** Бизнес-логика, которая несет ценность для пользователя (например, `user-avatar-generator`, `report-player`).
*   **entities:** Бизнес-сущности (например, `User`, `Team`). Являются "скелетом" приложения.
*   **shared:** Переиспользуемый код, не зависящий от бизнес-логики (UI-кит, утилиты, хуки, API).

### 5.2. Правила взаимодействия

Модули могут импортировать только из слоев, находящихся ниже них (`views` -> `widgets` -> `features` -> `entities` -> `shared`). Модули из одного слайса не должны импортировать внутренние файлы другого слайса.

## 6. Функциональные спецификации

### 6.1. Система Очков и Рейтингов (Концепция)

Платформа использует систему очков опыта (XP) для отражения вовлеченности пользователя. Очки начисляются за различные действия: победы в матчах, создание команды, выполнение квестов. Накопленные XP определяют ранг пользователя на платформе.

### 6.2. Система Верификации (Концепция)

Для значимых достижений (например, "пробежал марафон") планируется внедрение системы верификации сообществом. Пользователь загружает доказательство, а другие участники (например, подписчики) подтверждают его подлинность.

## 7. Записи об архитектурных решениях (ADR)

Этот раздел содержит записи о ключевых архитектурных решениях, принятых в ходе разработки.

### ADR-001: Выбор Feature-Sliced Design (FSD)

*   **Статус:** Принято.
*   **Контекст:** Проект является крупной социальной платформой с большим количеством разнообразных функций. Требовалась архитектура, которая обеспечит масштабируемость и низкую связанность модулей.
*   **Решение:** Выбрать методологию FSD в качестве основного способа организации кодовой базы.
*   **Обоснование:** FSD позволяет легко добавлять новые фичи, не затрагивая существующие, и упрощает командную работу.

### ADR-002: Выбор технологического стека

*   **Статус:** Принято.
*   **Контекст:** Необходимо было выбрать основной технологический стек для фронтенда.
*   **Решение:** Использовать связку Next.js (App Router) + TypeScript + Tailwind CSS + ShadCN UI.
*   **Обоснование:** Этот стек является современным стандартом для создания производительных и надежных React-приложений.

### ADR-003: Использование Genkit для AI-функциональности

*   **Статус:** Принято.
*   **Контекст:** Требовался стандартизированный способ взаимодействия с LLM.
*   **Решение:** Использовать Genkit от Google в качестве основного инструмента для разработки AI-фичей.
*   **Обоснование:** Genkit предоставляет единый API, хорошую интеграцию с Next.js и позволяет создавать сложную, но управляемую логику для ИИ-агентов с помощью `flows` и `tools`.

### ADR-004: Выбор Kafka в качестве брокера сообщений для бэкенда

*   **Статус:** Принято.
*   **Контекст:** Бэкенд должен поддерживать до 80 млн. пользователей и функционал стриминга.
*   **Решение:** Для бэкенда выбран Apache Kafka.
*   **Обоснование:** Kafka обеспечивает необходимую масштабируемость, пропускную способность и нативные возможности обработки потоков, что критично для заявленных нагрузок. Подробнее — в [документации бэкенда](/documents/backend-documentation).

# Техническая Документация Проекта "ProDvor"

**Версия:** 1.4 | **Дата последнего обновления:** 31.07.2024

Этот документ является основным техническим руководством для разработчиков фронтенд-части платформы "ProDvor". Он описывает архитектуру, технологический стек, стандарты кодирования и ключевые принятые решения.

## 1. Введение

### 1.1. Общее описание продукта

ProDvor — это социальная веб-платформа, предназначенная для объединения участников дворового и любительского спорта. Она предоставляет инструменты для создания профилей, команд, организации турниров и ведения спортивной жизни онлайн.

**Цели фронтенда:**

*   Предоставить пользователям интуитивно понятный, быстрый и адаптивный интерфейс.
*   Обеспечить высокую производительность и доступность на всех современных устройствах.
*   Создать масштабируемую и поддерживаемую кодовую базу, готовую к быстрому добавлению нового функционала.

### 1.2. Термины и сокращения

*   **FSD (Feature-Sliced Design)** — основная архитектурная методология проекта.
*   **RSC (React Server Components)** — серверные компоненты React, используемые по умолчанию.
*   **ADR (Architecture Decision Record)** — запись об архитектурном решении.
*   **NFR (Non-Functional Requirements)** — нефункциональные требования.
*   **API** — интерфейс взаимодействия с бэкендом.
*   **PD (ProDvor Dollars)** — внутренняя валюта платформы.
*   **XP (Experience Points)** — очки опыта, определяющие ранг пользователя.

## 2. Требования к фронтенду

### 2.1. Требования к платформе

*   **Фреймворк:** Next.js 15.3+ (App Router).
*   **Язык:** TypeScript.
*   **Сборщик:** Turbopack (в режиме разработки).
*   **Стилизация:** Tailwind CSS.
*   **UI-компоненты:** ShadCN UI.
*   **AI-функциональность:** Genkit.

### 2.2. Требования к браузерам и устройствам

*   **Десктопные браузеры:** Последние 2 версии Google Chrome, Mozilla Firefox, Apple Safari, Microsoft Edge.
*   **Мобильные браузеры:** Safari на iOS, Google Chrome на Android.
*   **Устройства:** Адаптивность для смартфонов, планшетов и десктопов (mobile-first).

### 2.3. Безопасность

*   **Протокол:** Приложение должно работать исключительно по HTTPS.
*   **Хранение токенов:** Сессия пользователя хранится в `httpOnly` cookie. Это предотвращает доступ к сессии через JavaScript на клиенте и защищает от XSS-атак.
*   **Защита маршрутов:** Middleware (`src/middleware.ts`) проверяет наличие cookie сессии и защищает все непубличные маршруты.
*   **CSRF:** Next.js имеет встроенные механизмы защиты от CSRF.
*   **Планы на продакшен:** Переход на JWT-токены и связку Kong + Keycloak, как описано в [документации бэкенда](/documents/backend-documentation).

### 2.4. Нефункциональные требования (NFRs)

*   **Производительность:**
    *   **LCP (Largest Contentful Paint):** не более 2.5 секунд.
    *   **FID (First Input Delay):** не более 100 мс.
    *   **Размер бандла JS** для первоначальной загрузки не должен превышать 200 KB (до сжатия).
*   **Доступность (a11y):**
    *   Все интерактивные элементы доступны с клавиатуры.
    *   Использование семантического HTML и ARIA-атрибутов.
*   **Надежность:**
    *   Использование `error.js` для обработки ошибок на уровне маршрутов.
    *   Централизованная обработка ошибок в Server Actions и Genkit-флоу.

## 3. Информационная архитектура

### 3.1. Карта страниц (Sitemap)

*Источник правды: `/src/app/(app)/administration/sitemap/page.tsx`.*

### 3.2. Модели данных

*Источник правды: Файлы `types.ts` внутри каждого слайса в `src/entities/`.*

## 4. UI/UX-документация

*   **Библиотека компонентов:** ShadCN UI (`src/shared/ui/`).
*   **Цветовая палитра:** CSS-переменные HSL в `src/app/globals.css`.
*   **Типографика:** Шрифты Inter и Space Grotesk. Конфигурация в `tailwind.config.ts`.
*   **Иконки:** Lucide React.
*   **Классы:** `clsx` и `tailwind-merge` для управления классами.

## 5. FSD-структура проекта

*   **app:** Инициализация, глобальные стили, провайдеры, макеты.
*   **views:** Компоненты страниц, собирающие виджеты.
*   **widgets:** Составные блоки UI (например, `Sidebar`, `TeamChat`).
*   **features:** Бизнес-логика (например, `user-avatar-generator`, `report-player`).
*   **entities:** Бизнес-сущности (например, `User`, `Team`).
*   **shared:** Переиспользуемый код (UI-кит, утилиты, конфиги, API).

## 6. Функциональные спецификации

### 6.1. Система Очков и Рейтингов (Концепция)
Платформа использует двухтрековую систему прогрессии:

1. **Рейтинг ELO**: Отражает мастерство игрока в конкретном виде спорта. Изменяется при победах/поражениях.
2. **Очки Опыта (XP)**: Накопительный показатель вовлеченности (участие в матчах, квесты, социальная активность). Определяет **ранг** пользователя на платформе.

Для обеспечения справедливой системы для всех возрастов, планируется **возрастной мультипликатор** на получаемые XP (конфигурация будет на бэкенде).

### 6.2. Система Достижений и Верификации (Концепция)
Достижения делятся на два типа:
- **Системные (Автоматические)**: Начисляются за действия на платформе (создал команду, оставил комментарий). Верификация не требуется.
- **Верифицируемые (Пользовательские)**: Начисляются за достижения в реальном мире (пробежал марафон). Требуют подтверждения от сообщества или верифицированного тренера/судьи.

### 6.3. Управление правилами и экономикой
Ключевые игровые механики настраиваются в файлах конфигурации, что позволяет быстро изменять баланс без правок в коде.

*   **Ранги**:
    *   **Назначение**: Определяют статус пользователя на платформе на основе XP.
    *   **Где редактировать**: `src/shared/config/ranks.ts`.
    *   **Как редактировать**: Измените массив `RANKS`, добавив или изменив объекты с `name`, `minPoints`, `maxPoints`, `title` и `color`.

*   **Экономика (PD)**:
    *   **Назначение**: Управляет начислением и списанием внутренней валюты (ProDvor Dollars).
    *   **Где редактировать**: `src/shared/config/gamification.ts`.
    *   **Как редактировать**: Измените массив `pdRules`, который содержит правила для начисления и списания PD. Вы можете менять `description`, `value` и флаг `editable`.

*   **Достижения (Achievements)**:
    *   **Назначение**: Награды за выполнение определенных действий.
    *   **Где редактировать**: На данном этапе прототипа достижения жестко прописаны в файлах моковых данных для каждого профиля (например, `src/shared/lib/mock-data/profiles.ts`, `src/shared/lib/mock-data/admin-profile.ts`).
    *   **План**: В продакшене будет создан единый конфигурационный файл или таблица в БД.

*   **Бейджи (Badges)**:
    *   **Назначение**: Визуальные значки для отображения статуса или особых заслуг.
    *   **Где редактировать**: На данном этапе бейджи являются частью UI и вызываются напрямую в компонентах (например, в `src/entities/player/ui/player-profile.tsx`). Централизованной системы конфигурации пока нет.
    *   **План**: Создание системы, где бейджи могут присваиваться пользователям динамически.


## 7. Записи об архитектурных решениях (ADR)

### ADR-001: Выбор Feature-Sliced Design (FSD)
*   **Статус:** Принято.
*   **Контекст:** Требовалась масштабируемая архитектура для крупного проекта.
*   **Решение:** Использовать FSD для организации кодовой базы.
*   **Обоснование:** Обеспечивает низкую связанность модулей и упрощает командную работу.

### ADR-002: Выбор технологического стека
*   **Статус:** Принято.
*   **Решение:** Использовать связку Next.js (App Router) + TypeScript + Tailwind CSS + ShadCN UI.
*   **Обоснование:** Современный стандарт для создания производительных и надежных React-приложений.

### ADR-003: Использование Genkit для AI-функциональности
*   **Статус:** Принято.
*   **Решение:** Использовать Genkit от Google для разработки AI-фичей.
*   **Обоснование:** Предоставляет единый API, хорошую интеграцию с Next.js и позволяет создавать управляемую логику для ИИ-агентов.

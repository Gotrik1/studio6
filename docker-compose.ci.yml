# This file overrides the default docker-compose.yml for CI environments.

services:
  migrations:
    image: prodvor/backend:latest
    command: pnpm --filter prodvor-backend prisma:migrate:deploy
    depends_on:
      db:
        condition: service_healthy
    env_file:
      - ./.env
    networks:
      - prodvor-network

  backend:
    image: prodvor/backend:latest # Ensure we use the freshly built image
    logging:
      driver: "json-file"
    depends_on:
      migrations:
        condition: service_completed_successfully

  frontend:
    image: prodvor/frontend:latest # Ensure we use the freshly built image
    logging:
      driver: "json-file"

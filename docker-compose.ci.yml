version: '3.8'

services:
  # Только специфичные для CI сервисы — например, миграции или тестовые моки.
  # Остальные сервисы (backend, db, frontend, keycloak, minio и т.д.) у тебя должны быть описаны в основном docker-compose.yml!

  migrations:
    image: node:20-alpine
    depends_on:
      - db
    working_dir: /app
    volumes:
      - ./backend:/app
    entrypoint: ["pnpm", "--filter", "prodvor-backend", "prisma:migrate:deploy"]
    environment:
      - DATABASE_URL=${DATABASE_URL}
    networks:
      - default

networks:
  default:
    external: false

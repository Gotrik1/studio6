# This file overrides the default docker-compose.yml for CI environments.

services:
  migrations:
    image: prodvor/backend:latest
    command: pnpm --filter prodvor-backend prisma:migrate:deploy
    depends_on:
      db:
        condition: service_healthy
    env_file:
      - ./.env
    networks:
      - prodvor-network
    restart: "no"

  backend:
    image: prodvor/backend:latest
    command: pnpm --filter prodvor-backend start:prod
    depends_on:
      migrations:
        condition: service_completed_successfully
    env_file:
      - ./.env
    ports:
      - "3001:3001"
    networks:
      - prodvor-network
    restart: on-failure

  frontend:
    image: prodvor/frontend:latest
    depends_on:
      - backend

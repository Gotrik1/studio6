FROM quay.io/keycloak/keycloak:25.0.1 as builder

# Enable health and metrics support
RUN /opt/keycloak/bin/kc.sh build --health-enabled=true --metrics-enabled=true --db=postgres

# Copy the realm configuration into the image
COPY ./config/keycloak/realm-export.json /opt/keycloak/data/import/realm-export.json

# Set correct permissions for the imported realm file
RUN chown keycloak:keycloak /opt/keycloak/data/import/realm-export.json

EXPOSE 8080

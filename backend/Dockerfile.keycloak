# Stage 1: Builder to get wget
FROM registry.access.redhat.com/ubi8-minimal AS builder
RUN microdnf install -y wget && microdnf clean all

# Stage 2: Main Keycloak image
FROM quay.io/keycloak/keycloak:26.3.1 as keycloak-server
COPY --from=builder /usr/bin/wget /usr/bin/
WORKDIR /opt/keycloak
RUN /opt/keycloak/bin/kc.sh build --db=postgres
CMD ["start", "--optimized"]

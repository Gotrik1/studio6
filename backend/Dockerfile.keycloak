# Stage 1: Builder with package manager
FROM registry.access.redhat.com/ubi8-minimal AS builder
RUN microdnf install -y wget && microdnf clean all

# Stage 2: Final Keycloak image
FROM quay.io/keycloak/keycloak:26.3.1
COPY --from=builder /usr/bin/wget /usr/bin/wget

# Set the default command to start Keycloak in production mode.
# This ensures that when 'docker compose up' is run, it starts correctly
# after the 'build' step has been performed in the CI pipeline.
CMD ["start", "--optimized"]

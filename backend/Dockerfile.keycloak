FROM quay.io/keycloak/keycloak:25.0.1 as builder

WORKDIR /opt/keycloak

RUN /opt/keycloak/bin/kc.sh build --db=postgres --health-enabled=true --metrics-enabled=true

FROM quay.io/keycloak/keycloak:25.0.1
COPY --from=builder /opt/keycloak/ /opt/keycloak/

COPY ./config/keycloak/realm-export.json /opt/keycloak/data/import/realm-export.json
RUN chown keycloak:keycloak /opt/keycloak/data/import/realm-export.json

ENTRYPOINT ["/opt/keycloak/bin/kc.sh"]
CMD ["start-dev", "--import-realm"]

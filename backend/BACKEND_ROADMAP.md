# Дорожная карта разработки бэкенда "ProDvor"

Этот документ представляет собой высокоуровневый план по переходу от высококачественного прототипа к полноценной, готовой к производству системе.

## Фаза 1: Прототипирование и Архитектура (Завершено)

- **Цель:** Создать безопасную, масштабируемую и функциональную основу для всего приложения.
- **Статус:** **Выполнено.**
- **Ключевые результаты:**
  - ✅ **Настроена вся инфраструктура:** PostgreSQL, Keycloak, Kong, Kafka, RabbitMQ, Redis развернуты и сконфигурированы.
  - ✅ **Разработана полная схема данных:** Схема в Prisma полностью нормализована, типизирована и готова к работе.
  - ✅ **Реализованы все AI-фичи:** Все вызовы к Genkit инкапсулированы на бэкенде.
  - ✅ **Созданы прототипы API:** Разработаны все необходимые эндпоинты и DTO, обеспечивающие работу фронтенда на моковых и реальных данных.
  - ✅ **Заложен фундамент для Observability:** Создан `MonitoringModule` с логгером, интерцептором и фильтром ошибок.
  - ✅ **Заложен фундамент для хранения файлов:** Создан `StorageModule` для работы с S3-совместимыми хранилищами.
  - ✅ **Заложен фундамент для кэширования:** Создан `CacheModule` для работы с Redis.

---

## Фаза 2: Переход к Production (Текущий этап)

- **Цель:** Заменить все прототипные решения на production-ready системы, обеспечив стабильность, безопасность и надежность.
- **Статус:** **В процессе.**

### Под-этап 2.1: Полное "оживление" API (Наивысший приоритет)

- **Задача:** Полностью искоренить все моковые (тестовые) данные и заменить их на реальные API-вызовы, взаимодействующие с базой данных PostgreSQL через Prisma.
- **Ключевые шаги:**
  - [ ] **Реализовать бизнес-логику:** Прописать полную реализацию для всех сервисов.
    - ✅ `UsersService` — профили и статистика теперь формируются на основе реальных данных из БД.
    - ✅ `ChatService` — обмен сообщениями в реальном времени через Kafka.
    - ✅ `NotificationsService` — асинхронная доставка уведомлений через RabbitMQ.
    - ✅ `AiService` — все AI-потоки работают с реальными вызовами Genkit.
    - ✅ `FriendsService` — управление друзьями и запросами.
    - ✅ `TeamsService` — управление командами, составами, статистикой.
    - ✅ `AchievementsService` — логика разблокировки достижений.
    - ✅ `TournamentsService` — создание, управление и проведение турниров.
    - ✅ `MatchesService` — управление матчами, результатами и спорами.
    - ✅ `PlaygroundsService` — управление площадками, отзывами, чекинами.
    - [ ] `AdminService` — агрегация данных для панели администратора.
    - ✅ `ActivitiesService` — управление лентой активности.
    - ✅ `LfgService` — управление лобби для поиска игр.
    - ✅ `TeamApplicationsService` — обработка заявок на вступление в команды.
    - [ ] `ReportsService` — обработка жалоб пользователей.
    - ✅ `ChallengesService` — управление личными вызовами.
    - ✅ `TrainingService` — управление программами тренировок и упражнениями.
    - ✅ `StoreService` — управление товарами в магазине.
    - [ ] `LeaguesService` — управление лигами и сезонами.
    - ✅ `PollsService` — управление опросами.
    - ✅ `QuestsService` — управление квестами и наградами.
    - ✅ `InventoryService` — управление инвентарем пользователя.
    - ✅ `NutritionService` — управление базой продуктов и дневником питания.
    - ✅ `CoachesService` — управление профилями тренеров.
    - ✅ `SponsorsService` — управление профилями спонсоров.
    - ✅ `SponsorshipService` — логика спонсорских контрактов.
    - ✅ `SponsorshipOffersService` — управление входящими предложениями от спонсоров.
    - ✅ `MeasurementsService` — управление замерами тела.
    - ✅ `TrainingProposalsService` — управление предложениями о тренировках.
    - ✅ `FaqService` — управление базой знаний.
    - ✅ `...и все остальные микро-сервисы и утилиты.`
  - [ ] **Переписать фронтенд-клиенты:** Убедиться, что все функции в `frontend/src/entities/**/api/*.ts` обращаются к реальным, а не моковым эндпоинтам.
  - [ ] **Проверить целостность данных:** Убедиться, что все CRUD-операции корректно работают с базой данных.

### Под-этап 2.2: Внедрение Production-аутентификации

- **Задача:** Заменить текущую прототипную систему аутентификации на безопасную и масштабируемую связку Keycloak + Kong.
- **Ключевые шаги:**
  - [ ] **Настроить OIDC-плагин в Kong:** Обеспечить валидацию JWT-токенов от Keycloak на уровне API-шлюза.
  - [ ] **Переписать флоу входа/регистрации:** Адаптировать фронтенд для работы со стандартным OIDC-флоу вместо `login/register` Server Actions.
  - [ ] **Удалить небезопасную логику:** Полностью убрать `AuthService` на бэкенде, который обрабатывает пароли, и бэкдор администратора.

### Под-этап 2.3: Тестирование и Надежность

- **Задача:** Обеспечить стабильность и качество кода перед запуском.
- **Ключевые шаги:**
  - [ ] **Покрытие тестами:** Написать юнит- и интеграционные тесты для критически важной бизнес-логики на бэкенде.
  - ✅ **Настроить Observability:** Внедрены базовые модули для мониторинга (`MonitoringModule`), логирования (`JsonLogger`) и обработки ошибок (`HttpExceptionFilter`). 
  - [ ] Требуется полная интеграция с Prometheus/Grafana/Sentry.

### Под-этап 2.4: Финальная подготовка к запуску

- **Задача:** Подготовить проект к развертыванию и долгосрочной поддержке.
- **Ключевые шаги:**
  - [ ] **Оптимизировать CI/CD:** Улучшить пайплайны в `.github/workflows/main.yml` для production-сборок.
  - [ ] **Проверить и обновить документацию:** Убедиться, что все документы (`ARCHITECTURE.md`, `README.md` и т.д.) на 100% соответствуют финальному продукту.

---

## ✅ Приложение будет готово к запуску после завершения Фазы 2.

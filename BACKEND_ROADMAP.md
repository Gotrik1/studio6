# Дорожная карта разработки бэкенда

Этот документ представляет собой высокоуровневый план по созданию серверной части для платформы "ProDvor", заменяя текущие моковые данные и Server Actions.

## Фаза 1: Фундамент и Аутентификация

-   **Цель:** Создать безопасную и масштабируемую основу для всего приложения.
-   **Ключевые задачи:**
    1.  **Настройка СУБД:** Развернуть и настроить кластер PostgreSQL.
    2.  **Схема данных:** Разработать и финализировать схему данных с помощью Prisma ORM. Настроить миграции.
    3.  **Identity Provider:** Интегрировать Keycloak для управления пользователями, ролями и аутентификацией.
    4.  **API Gateway:** Настроить Kong для маршрутизации запросов и защиты эндпоинтов с помощью OIDC-плагина.
    5.  **Замена моков:** Заменить `features/auth/actions.ts` и систему сессий на основе cookie на полноценный OIDC-флоу с JWT-токенами.

## Фаза 2: Основное API и Бизнес-логика

-   **Цель:** Реализовать все ключевые функции платформы на стороне сервера.
-   **Ключевые задачи:**
    1.  **CRUD для сущностей:** Разработать API-эндпоинты (REST или GraphQL) для всех основных сущностей: `Users`, `Teams`, `Matches`, `Tournaments`, `Playgrounds`.
    2.  **Бизнес-логика:** Реализовать серверную логику для всех фич: создание команд, система заявок, отчеты о результатах матчей, генерация турнирных сеток.
    3.  **API для геймификации:** Создать эндпоинты для управления экономикой PD, квестами и достижениями.
    4.  **Уведомления:** Разработать сервис для отправки push- и email-уведомлений.

## Фаза 3: Real-time и AI-интеграция

-   **Цель:** Внедрить асинхронное взаимодействие и защитить вызовы к AI.
-   **Ключевые задачи:**
    1.  **Брокер сообщений:** Интегрировать Kafka для чатов и асинхронных операций.
    2.  **WebSocket API:** Разработать сервис для real-time чатов.
    3.  **AI Gateway:** Создать защищенный BFF (Backend-for-Frontend) или отдельный сервис для проксирования запросов к Genkit, чтобы `GOOGLE_API_KEY` не хранился на клиенте.
    4.  **Векторная база данных:** Настроить и интегрировать векторную базу данных (например, Pinecone или pgvector) для RAG-сценариев (умный поиск, FAQ-бот).

## Фаза 4: Тестирование, CI/CD и Развертывание

-   **Цель:** Обеспечить стабильность, надежность и автоматизацию процессов.
-   **Ключевые задачи:**
    1.  **Тестирование:** Покрыть критически важную бизнес-логику юнит- и интеграционными тестами.
    2.  **CI/CD:** Настроить пайплайны для автоматической сборки, тестирования и развертывания микросервисов.
    3.  **Контейнеризация:** Упаковать все сервисы в Docker-контейнеры.
    4.  **Продакшен-окружение:** Настроить логирование, мониторинг (Prometheus, Grafana) и алертинг для всех компонентов системы.
